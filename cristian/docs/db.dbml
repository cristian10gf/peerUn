Project peerun {
	database_type: 'PostgreSQL'
	Note: 'Modelo base de PeerUn (profesores, estudiantes, cursos, grupos y evaluación entre pares).'
}

Enum user_role {
	teacher
	student
}

Enum actividad_visibilidad {
	publica
	privada
}

Enum actividad_estado {
	activa
	cerrada
}

Table usuarios {
	id uuid [pk]
	nombre varchar(120) [not null]
	email varchar(160) [not null, unique]
	rol user_role [not null]
	created_at timestamptz [not null, default: `now()`]
	updated_at timestamptz [not null, default: `now()`]

	Note: 'Usuarios autenticados en Roble.'
}

Table cursos {
	id uuid [pk]
	nombre varchar(160) [not null]
	profesor_id uuid [not null]
	created_at timestamptz [not null, default: `now()`]
	updated_at timestamptz [not null, default: `now()`]

	indexes {
		(profesor_id, nombre)
	}

	Note: 'Curso creado y administrado por un profesor.'
}

Table curso_estudiantes {
	id uuid [pk]
	estudiante_id uuid [not null]
	curso_id uuid [not null]
	created_at timestamptz [not null, default: `now()`]

	indexes {
		(curso_id, estudiante_id) [unique]
	}

	Note: 'Matrícula de estudiantes por curso (vía invitación/enlace mágico).'
}

Table categorias_grupo {
	id uuid [pk]
	curso_id uuid [not null]
	nombre varchar(120) [not null]
	created_at timestamptz [not null, default: `now()`]

	indexes {
		(curso_id, nombre) [unique]
	}

	Note: 'Categorías importadas desde Brightspace (ej: Grupo Proyecto 1).'
}

Table grupos {
	id uuid [pk]
	categoria_id uuid [not null]
	nombre varchar(120) [not null]
	created_at timestamptz [not null, default: `now()`]

	indexes {
		(categoria_id, nombre) [unique]
	}

	Note: 'Grupo específico dentro de una categoría.'
}

Table grupo_miembros {
	id uuid [pk]
	estudiante_id uuid [not null]
	grupo_id uuid [not null]
	created_at timestamptz [not null, default: `now()`]

	indexes {
		(grupo_id, estudiante_id) [unique]
	}

	Note: 'Relación de integrantes por grupo.'
}

Table actividades {
	categoria_id uuid [not null]
	id uuid [pk]
	nombre varchar(180) [not null]
	ventana_minutos int [not null]
	visibilidad actividad_visibilidad [not null, default: 'privada']
	curso_id uuid [not null]
	estado actividad_estado [not null, default: 'activa']
	creada_at timestamptz [not null, default: `now()`]
	cerrada_at timestamptz

	indexes {
		(curso_id, categoria_id)
		(curso_id, estado)
	}

	Note: 'Evaluación lanzada por el profesor para una categoría de grupos.'
}

Table respuestas {
	actividad_id uuid [not null]
	id uuid [pk]
	evaluador_id uuid [not null]
	evaluado_id uuid [not null]
	criterios_id uuid [not null]
	created_at timestamptz [not null, default: `now()`]

	indexes {
		(actividad_id, evaluador_id, evaluado_id) [unique]
		(actividad_id, evaluado_id)
	}

	Note: 'Sin autoevaluación: evaluador_id debe ser distinto de evaluado_id (validar en app/DB).'
}

Table criterios {
  id uuid [pk]
  respuesta_id uuid [not null]
  puntualidad decimal(3,1) [not null, note: 'Escala 2.0 a 5.0']
	contribuciones decimal(3,1) [not null, note: 'Escala 2.0 a 5.0']
	compromiso decimal(3,1) [not null, note: 'Escala 2.0 a 5.0']
	actitud decimal(3,1) [not null, note: 'Escala 2.0 a 5.0']
  created_at timestamptz [not null, default: `now()`]

  Note: 'Criterios de evaluación definidos por el profesor para cada actividad.'
}

Table invitaciones_estudiante {
	id uuid [pk]
	curso_id uuid [not null]
	email_destino varchar(160)
	token varchar(255) [not null, unique]
	expira_at timestamptz [not null]
	usado boolean [not null, default: false]
	created_by uuid [not null]
	created_at timestamptz [not null, default: `now()`]

	indexes {
		(curso_id, expira_at)
	}

	Note: 'Enlace mágico de invitación (vigencia típica: 48h).'
}

Ref: cursos.profesor_id > usuarios.id
Ref: curso_estudiantes.curso_id > cursos.id
Ref: curso_estudiantes.estudiante_id > usuarios.id
Ref: categorias_grupo.curso_id > cursos.id
Ref: grupos.categoria_id > categorias_grupo.id
Ref: grupo_miembros.grupo_id > grupos.id
Ref: grupo_miembros.estudiante_id > usuarios.id
Ref: actividades.curso_id > cursos.id
Ref: actividades.categoria_id > categorias_grupo.id
Ref: respuestas.actividad_id > actividades.id
Ref: respuestas.evaluador_id > usuarios.id
Ref: respuestas.evaluado_id > usuarios.id
Ref: invitaciones_estudiante.curso_id > cursos.id
Ref: invitaciones_estudiante.created_by > usuarios.id
Ref: criterios.respuesta_id > respuestas.id
